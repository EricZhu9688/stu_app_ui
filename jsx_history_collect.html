<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>错题上传与收集</title>
    <script src="js/tailwind.min.js"></script>
    <script src="js/lucide.js"></script>
    <style>
        /* 引入中文字体支持 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+SC:wght@100..900&display=swap');

        /* 定义主题色：#09c0d7 */
        :root {
            --font-main: 'Noto Sans SC', 'Inter', sans-serif;
            --color-primary-hex: #09c0d7;
            --color-primary-600: #0698ab;
            --color-primary-500: #09c0d7;
            --color-primary-300: #7fdce7;
        }

        body {
            font-family: var(--font-main);
            background-color: #f3f4f6;
            /* gray-100 */
        }

        .interactive-button,
        .interactive-card {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }

        .interactive-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .interactive-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .bg-primary-500 {
            background-color: var(--color-primary-500);
        }

        .text-primary-600 {
            color: var(--color-primary-600);
        }
    </style>
</head>

<body>

    <div id="app" class="min-h-screen">
        <!-- 顶栏 -->
        <header class="sticky top-0 bg-white p-4 z-10 border-b shadow-sm">
            <div class="max-w-4xl mx-auto flex items-center">
                <button onclick="console.log('返回错题本首页')" class="text-gray-600 p-2 rounded-full hover:bg-gray-100 mr-2">
                    <svg class="lucide-icon w-6 h-6" data-lucide="chevron-left"></svg>
                </button>
                <h1 class="text-xl font-bold text-gray-800">基础作业错题收集</h1>
            </div>
        </header>

        <main class="p-4 max-w-4xl mx-auto space-y-8">

            <!-- 1. 核心操作区：拍照上传 -->
            <div class="text-center p-8 bg-white rounded-3xl shadow-xl border border-gray-100 space-y-4">
                <p class="text-sm font-medium text-gray-500">将纸质作业转化为个性化学习数据，实现精准巩固。</p>

                <div class="relative inline-block">
                    <!-- 核心按钮：拍照上传 -->
                    <button onclick="handleNavigation('uploadNew', '拍照上传作业')"
                        class="interactive-button w-64 h-64 rounded-full bg-primary-500 text-white shadow-2xl flex flex-col items-center justify-center space-y-3 transform scale-100 transition-transform duration-300 hover:scale-[1.02]"
                        style="box-shadow: 0 10px 30px rgba(9, 192, 215, 0.5);">
                        <svg class="lucide-icon w-16 h-16" data-lucide="camera"></svg>
                        <span class="text-2xl font-bold">拍照上传作业</span>
                        <span class="text-sm opacity-80">(基础性作业)</span>
                    </button>
                    <!-- 浮动提示：快速通道 -->
                    <div
                        class="absolute top-0 right-0 -mr-4 -mt-4 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform rotate-6">
                        最快 3 秒识别
                    </div>
                </div>

                <div class="pt-4 text-center">
                    <button onclick="handleNavigation('uploadLocal', '从相册选择')"
                        class="text-primary-600 font-semibold hover:underline flex items-center justify-center space-x-1 mx-auto">
                        <svg class="lucide-icon w-4 h-4" data-lucide="upload-cloud"></svg>
                        <span>或从相册选择照片上传</span>
                    </button>
                </div>
            </div>

            <!-- 2. 上传收集历史记录 -->
            <section class="space-y-4">
                <h2 class="text-xl font-bold text-gray-700 flex items-center space-x-2">
                    <svg class="lucide-icon w-5 h-5 text-gray-500" data-lucide="clock"></svg>
                    <span>最近收集记录</span>
                </h2>

                <div id="historyList" class="space-y-3">
                    <!-- 历史记录项将由 JS 插入 -->
                </div>

                <button onclick="handleNavigation('viewAllHistory', '查看所有历史')"
                    class="w-full py-3 text-sm font-medium text-gray-600 bg-white rounded-xl shadow-md border hover:bg-gray-50">
                    查看所有历史记录
                </button>
            </section>

        </main>
    </div>

    <!-- 模态框结构 (用于所有交互反馈) -->
    <div id="actionModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden"
        onclick="closeModal()">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-11/12 max-w-md" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800">操作确认</h3>
                <button class="text-gray-400 hover:text-gray-600" onclick="closeModal()">
                    <svg class="lucide-icon w-6 h-6" data-lucide="x-circle"></svg>
                </button>
            </div>
            <p id="modalMessage" class="text-gray-700 mb-6 leading-relaxed">操作详情将在此显示。</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-full hover:bg-gray-300 transition">关闭</button>
                <button onclick="closeModal()" id="modalActionButton"
                    class="px-4 py-2 text-white font-semibold rounded-full hover:opacity-90 transition bg-primary-500">确认</button>
            </div>
        </div>
    </div>

    <script>
        // --- 模拟数据 ---
        let collectionHistory = [
            { id: 101, name: '数学 第一单元作业', date: '2025-11-10', status: 'completed', errorCount: 5, timeTaken: '15秒' },
            { id: 102, name: '语文 基础知识练习', date: '2025-11-09', status: 'processing', errorCount: null, timeTaken: '2秒' },
            { id: 103, name: '英语 单词听写本', date: '2025-11-08', status: 'failed', errorCount: null, timeTaken: '10秒' },
            { id: 104, name: '数学 第二单元作业', date: '2025-11-05', status: 'completed', errorCount: 3, timeTaken: '12秒' },
        ];

        // --- 模态框及交互逻辑 ---

        function showModal(title, message, actionText = '确认') {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').innerHTML = message;
            const actionButton = document.getElementById('modalActionButton');
            actionButton.textContent = actionText;
            actionButton.onclick = closeModal; // 默认操作是关闭
            document.getElementById('actionModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('actionModal').classList.add('hidden');
        }

        /**
         * 模拟页面跳转/功能执行
         */
        function handleNavigation(target, name) {
            let message = '';
            let actionText = '立即执行';

            switch (target) {
                case 'uploadNew':
                    message = `您即将启动相机进行 **拍照上传**。请确保作业平整、光线充足。`;
                    break;
                case 'uploadLocal':
                    message = `您即将打开手机相册，选择作业照片进行 **上传识别**。`;
                    break;
                case 'viewDetails':
                    message = `您将查看 **${name}** 的详细收集结果和错题。`;
                    actionText = '查看详情';
                    break;
                case 'viewAllHistory':
                    message = `您将进入 **所有收集历史记录** 页面。`;
                    actionText = '进入历史';
                    break;
                default:
                    message = `您已点击 **${name}**。`;
            }

            showModal(name, message, actionText);
        }

        /**
         * 渲染单条历史记录
         */
        function renderHistoryItem(item) {
            let statusBadge = '';
            let icon = '';
            let detailText = '';
            let iconColor = '';
            let actionText = '查看结果';
            let actionTarget = 'viewDetails';

            switch (item.status) {
                case 'completed':
                    statusBadge = `<span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-600">收集完成</span>`;
                    icon = 'check-circle';
                    iconColor = 'text-green-500';
                    detailText = `识别错题 <span class="text-lg font-bold text-red-600">${item.errorCount}</span> 题`;
                    break;
                case 'processing':
                    statusBadge = `<span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-primary-500 text-white" style="background-color: var(--color-primary-500);">AI识别中...</span>`;
                    icon = 'clock';
                    iconColor = 'text-primary-500';
                    detailText = `已用时 ${item.timeTaken}，请稍候...`;
                    actionText = '刷新状态';
                    actionTarget = 'refreshStatus';
                    break;
                case 'failed':
                    statusBadge = `<span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-600">识别失败</span>`;
                    icon = 'x-circle';
                    iconColor = 'text-red-500';
                    detailText = `图片不清晰，请重新上传。`;
                    actionText = '重新上传';
                    actionTarget = 'reUpload';
                    break;
            }

            return `
                <div onclick="handleNavigation('${actionTarget}', '${item.name} (${statusBadge.replace(/<[^>]*>?/gm, '')})')" 
                     class="interactive-card bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between hover:border-primary-500">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 rounded-full ${iconColor.replace('text', 'bg')}-100">
                            <svg class="lucide-icon w-5 h-5 ${iconColor}" data-lucide="${icon}"></svg>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-base font-semibold text-gray-800">${item.name}</span>
                                ${statusBadge}
                            </div>
                            <p class="text-xs text-gray-500">上传于 ${item.date} | ${detailText}</p>
                        </div>
                    </div>
                    
                    <button class="flex items-center space-x-1 px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-200" onclick="event.stopPropagation(); showModal('删除记录', '确定要删除这条历史记录吗？', '删除');">
                        <svg class="lucide-icon w-4 h-4" data-lucide="trash-2"></svg>
                        <span>删除</span>
                    </button>
                </div>
            `;
        }

        /**
         * 渲染历史记录列表
         */
        function renderHistoryList() {
            const listContainer = document.getElementById('historyList');
            const htmlContent = collectionHistory.map(renderHistoryItem).join('');

            if (collectionHistory.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center p-8 bg-white rounded-xl text-gray-500">
                        <svg class="lucide-icon w-6 h-6 mx-auto mb-2" data-lucide="file-text"></svg>
                        <p class="text-sm">暂无上传记录。快点击上方按钮开始上传吧！</p>
                    </div>
                 `;
                document.querySelector('button[onclick*="viewAllHistory"]').classList.add('hidden');
            } else {
                listContainer.innerHTML = htmlContent;
                document.querySelector('button[onclick*="viewAllHistory"]').classList.remove('hidden');
            }
        }

        // 页面加载完成后，初始化渲染
        document.addEventListener('DOMContentLoaded', renderHistoryList);
    </script>
</body>

</html>