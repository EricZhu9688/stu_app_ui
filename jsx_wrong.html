<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”™é¢˜æ”»å…‹ä¸­å¿ƒ</title>
    <script src="js/tailwind.min.js"></script>
    <script src="js/lucide.js"></script>
    <link rel="stylesheet" href="js/components/SubjectSwitcher.css">
    <script src="js/components/SubjectSwitcher.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }

        .icon-small {
            width: 1rem;
            height: 1rem;
            stroke-width: 2.5;
        }

        .icon-base {
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal Animation */
        .modal-enter {
            animation: modalUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes modalUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Hide scrollbar for clean UI */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .card-selected {
            border-color: #09C0D7 !important;
            box-shadow: 0 0 0 2px rgba(9, 192, 215, 0.2) !important;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ¡é‡ç½® */
        #subject-tabs-container .subject-tab {
            color: rgba(255, 255, 255, 0.6) !important;
            font-size: 18px !important;
            font-weight: 500 !important;
            padding-bottom: 4px !important;
            position: relative;
        }
        #subject-tabs-container .subject-tab.active {
            color: #ffffff !important;
            font-weight: 700 !important;
        }
        #subject-tabs-container .subject-tab.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 4px;
            background: #ffffff;
            border-radius: 2px;
        }

        /* èƒ¶å›ŠæŒ‰é’®æ ·å¼ */
        .capsule-btn {
            background: rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 999px;
            padding: 4px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* åŒè‰²è¿›åº¦æ¡å¥æŸ„ */
        .progress-handle {
            position: absolute;
            top: 50%;
            left: 40%;
            transform: translate(-50%, -50%);
            width: 14px;
            height: 14px;
            background: #96A7F0;
            border: 2px solid #ffffff;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 5;
        }

        /* ç­›é€‰èŠ¯ç‰‡æ ·å¼ */
        .filter-chip-row {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            padding: 12px 0;
        }
        .filter-chip-item {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            position: relative;
        }
    </style>
</head>

<body class="p-0 m-0">

    <div class="min-h-screen bg-gray-50 pb-24 max-w-md mx-auto shadow-2xl relative">

        <!-- 1. å¤´éƒ¨ï¼šæˆ˜åœºä»ªè¡¨ç›˜ -->
        <div class="bg-[#6378D1] text-white p-5 pt-8 rounded-b-[2rem] shadow-lg relative z-10">
            <div class="flex justify-between items-center mb-10">
                <!-- å­¦ç§‘ç­›é€‰ (æ¨ªå‘å¹³é“º) -->
                <div class="flex items-center gap-6" id="subject-tabs-container">
                    <!-- ç”± SubjectSwitcher ç»„ä»¶åŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- èƒ¶å›Šèœå• -->
                <div class="capsule-btn">
                    <div class="flex gap-1">
                        <div class="w-1.5 h-1.5 bg-white rounded-full opacity-40"></div>
                        <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
                        <div class="w-1.5 h-1.5 bg-white rounded-full opacity-40"></div>
                    </div>
                    <div class="w-[1px] h-3 bg-white/20"></div>
                    <div class="w-3.5 h-3.5 border-2 border-white rounded-full flex items-center justify-center">
                        <div class="w-1 h-1 bg-white rounded-full"></div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®æ¦‚è§ˆ -->
            <div class="flex justify-between items-end mb-6">
                <div class="relative">
                    <div class="text-white/70 text-sm mb-1 font-medium">å½“å‰å¾…æ¶ˆç­</div>
                    <div class="flex items-baseline gap-1">
                        <span class="text-5xl font-bold text-[#FF8E5D]">57</span>
                        <span class="text-sm font-medium text-white/80 ml-1">é¢˜</span>
                    </div>
                </div>
                <div class="text-right pb-1">
                    <div class="text-white/70 text-sm mb-1 font-medium">æœ¬å‘¨å·²æ”»å…‹</div>
                    <div class="flex items-center justify-end gap-1 font-bold text-2xl text-white">
                        <i data-lucide="zap" class="w-6 h-6 fill-white"></i> 12 <span class="text-sm font-normal text-white/70 ml-0.5">é¢˜</span>
                    </div>
                </div>
            </div>

            <!-- è¿›åº¦æ¡ -->
            <div class="relative px-1 mb-2">
                <div class="bg-white/20 h-2.5 rounded-full overflow-hidden flex">
                    <div class="w-[40%] bg-[#FF8E5D]"></div>
                    <div class="w-[60%] bg-[#B2ED5E]"></div>
                </div>
                <div class="progress-handle"></div>
            </div>
            <div class="flex justify-between text-xs text-white/70 font-medium px-1 mb-4">
                <span>å¾…æ”»å…‹40%</span>
                <span>å·²æŒæ¡60%</span>
            </div>

            <!-- ç­›é€‰èŠ¯ç‰‡è¡Œ -->
            <div class="filter-chip-row scrollbar-hide">
                <div class="filter-chip-item" onclick="toggleModal('filter-modal')">
                    æ—¶é—´ <i data-lucide="chevron-down" class="w-4 h-4 opacity-60"></i>
                </div>
                <div class="filter-chip-item" onclick="toggleModal('filter-modal')">
                    éš¾åº¦ <i data-lucide="chevron-down" class="w-4 h-4 opacity-60"></i>
                </div>
                <div class="filter-chip-item" onclick="toggleModal('filter-modal')">
                    å¹´çº§ <i data-lucide="chevron-down" class="w-4 h-4 opacity-60"></i>
                </div>
                <div class="filter-chip-item" onclick="toggleModal('filter-modal')">
                    æ›´å¤š <i data-lucide="chevron-down" class="w-4 h-4 opacity-60"></i>
                </div>
                <div class="bg-white/10 p-2.5 rounded-full flex items-center justify-center ml-auto" onclick="toggleModal('download-modal')">
                    <i data-lucide="download" class="w-5 h-5 text-white/90"></i>
                </div>
            </div>
        </div>

        <!-- 2. åˆ—è¡¨åŒºåŸŸå®¹å™¨ (æ”¹ä¸ºåœ†è§’ç™½åº•) -->
        <div class="bg-white rounded-t-[2.5rem] -mt-8 relative z-20 min-h-[60vh] pb-24">
            <!-- 2.1 Tab åˆ‡æ¢ (å·²æ”»å…‹/å¾…æ”»å…‹) -->
            <div class="px-6 pt-8 pb-4">
                <div id="tab-container" class="flex bg-gray-100/80 rounded-2xl p-1.5 border border-gray-50">
                    <!-- Tabs injected via JS -->
                </div>
            </div>

            <!-- 3. é”™é¢˜åˆ—è¡¨ -->
            <div id="mistake-list" class="px-4 space-y-4">
                <!-- Cards injected via JS -->
            </div>
        </div>

        <!-- 4. åº•éƒ¨æ‚¬æµ®æŒ‰é’®: æ”¶é›†é”™é¢˜ (ç®€åŒ–ç‰ˆ) -->
        <div class="fixed bottom-6 right-6 z-20">
            <button onclick="collectWrong()"
                class="bg-[#09C0D7] text-white w-14 h-14 rounded-full shadow-xl shadow-cyan-200 flex items-center justify-center active:scale-95 transition-transform hover:bg-[#08acc0] border-2 border-white/20">
                <i data-lucide="camera" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- ================= å¼¹çª—åŒºåŸŸ ================= -->

        <!-- A. ç­›é€‰å¼¹çª— (Filter Modal) -->
        <div id="filter-modal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
                onclick="toggleModal('filter-modal')"></div>
            <div
                class="absolute bottom-0 w-full bg-white rounded-t-3xl p-6 modal-enter max-w-md mx-auto left-0 right-0 h-[85vh] flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-gray-800">ç­›é€‰é”™é¢˜</h3>
                    <button onclick="toggleModal('filter-modal')" class="text-gray-400 hover:text-gray-600"><i
                            data-lucide="x" class="icon-base"></i></button>
                </div>

                <div class="flex-1 overflow-y-auto scrollbar-hide space-y-8 pb-4">
                    <!-- 1. é”™å› è®°å½• (æ›´å¤šç­›é€‰çš„æ ¸å¿ƒå†…å®¹) -->
                    <div class="space-y-3">
                        <label class="text-sm font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-4 bg-[#09C0D7] rounded-full"></span> é”™å› è®°å½•
                        </label>
                        <div class="flex flex-wrap gap-2.5">
                            <filter-chip label="å®¡é¢˜ä¸æ¸…"></filter-chip>
                            <filter-chip label="æ¦‚å¿µæœªæŒæ¡"></filter-chip>
                            <filter-chip label="è¿ç®—é”™è¯¯"></filter-chip>
                            <filter-chip label="æ²¡æœ‰æ€è·¯"></filter-chip>
                            <filter-chip label="é©¬è™ç²—å¿ƒ"></filter-chip>
                            <filter-chip label="å…¬å¼è®°é”™"></filter-chip>
                            <filter-chip label="ä¹¦å†™ä¸è§„èŒƒ"></filter-chip>
                        </div>
                    </div>

                    <!-- 2. é¢˜å‹ (æ›´å¤šç­›é€‰çš„æ ¸å¿ƒå†…å®¹) -->
                    <div class="space-y-3">
                        <label class="text-sm font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-4 bg-[#09C0D7] rounded-full"></span> é¢˜å‹
                        </label>
                        <div class="flex flex-wrap gap-2.5">
                            <filter-chip label="é€‰æ‹©é¢˜" active></filter-chip>
                            <filter-chip label="å¡«ç©ºé¢˜" active></filter-chip>
                            <filter-chip label="åˆ¤æ–­é¢˜"></filter-chip>
                            <filter-chip label="è®¡ç®—é¢˜" active></filter-chip>
                            <filter-chip label="è§£ç­”é¢˜" active></filter-chip>
                            <filter-chip label="åº”ç”¨é¢˜"></filter-chip>
                            <filter-chip label="ä½œæ–‡"></filter-chip>
                        </div>
                    </div>

                    <div class="h-px bg-gray-100 w-full"></div>
                    <div class="text-[10px] text-gray-400 font-bold tracking-widest uppercase">å…¶ä»–ç­›é€‰</div>

                    <!-- 3. å¹´çº§ç­›é€‰ (å·²åœ¨å¤–è¡¨æ˜¾ç¤º) -->
                    <div class="space-y-3 opacity-60">
                        <label class="text-sm font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-4 bg-gray-300 rounded-full"></span> å¹´çº§
                        </label>
                        <div class="flex flex-wrap gap-2.5">
                            <filter-chip label="ä¸€å¹´çº§"></filter-chip>
                            <filter-chip label="äºŒå¹´çº§"></filter-chip>
                            <filter-chip label="ä¸‰å¹´çº§"></filter-chip>
                            <filter-chip label="å››å¹´çº§"></filter-chip>
                            <filter-chip label="äº”å¹´çº§" active></filter-chip>
                            <filter-chip label="å…­å¹´çº§"></filter-chip>
                            <filter-chip label="ä¸ƒå¹´çº§"></filter-chip>
                            <filter-chip label="å…«å¹´çº§"></filter-chip>
                            <filter-chip label="ä¹å¹´çº§"></filter-chip>
                        </div>
                    </div>

                    <!-- 4. éš¾åº¦ç­‰çº§ (å·²åœ¨å¤–è¡¨æ˜¾ç¤º) -->
                    <div class="space-y-3 opacity-60">
                        <label class="text-sm font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-4 bg-gray-300 rounded-full"></span> éš¾åº¦ç­‰çº§
                        </label>
                        <div class="flex flex-wrap gap-2.5">
                            <filter-chip label="1æ˜Ÿ (åŸºç¡€)"></filter-chip>
                            <filter-chip label="2æ˜Ÿ (ç®€å•)"></filter-chip>
                            <filter-chip label="3æ˜Ÿ (ä¸­ç­‰)" active></filter-chip>
                            <filter-chip label="4æ˜Ÿ (è¾ƒéš¾)"></filter-chip>
                            <filter-chip label="5æ˜Ÿ (å›°éš¾)"></filter-chip>
                        </div>
                    </div>

                    <!-- 5. å½•å…¥æ—¶é—´ (å·²åœ¨å¤–è¡¨æ˜¾ç¤º) -->
                    <div class="space-y-3 opacity-60">
                        <label class="text-sm font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-4 bg-gray-300 rounded-full"></span> å½•å…¥æ—¶é—´
                        </label>
                        <div class="flex flex-wrap gap-2.5">
                            <filter-chip label="æœ¬å‘¨" active></filter-chip>
                            <filter-chip label="æœ¬æœˆ"></filter-chip>
                            <filter-chip label="è¿‘3ä¸ªæœˆ"></filter-chip>
                            <filter-chip label="æœ¬å­¦æœŸ"></filter-chip>
                            <filter-chip label="å…¨éƒ¨æ—¶é—´"></filter-chip>
                            <filter-chip label="è‡ªå®šä¹‰æ—¥æœŸ"></filter-chip>
                        </div>
                    </div>
                </div>

                <div class="pt-4 border-t border-gray-100 mt-2 flex gap-3">
                    <button
                        class="flex-1 py-3.5 rounded-xl bg-gray-100 text-gray-600 font-bold text-sm hover:bg-gray-200 transition-colors">é‡ç½®</button>
                    <button onclick="toggleModal('filter-modal')"
                        class="flex-[2] py-3.5 rounded-xl bg-[#09C0D7] text-white font-bold text-sm shadow-lg shadow-cyan-100 hover:bg-[#08acc0] transition-colors">ç¡®è®¤ç­›é€‰
                        (12)</button>
                </div>
            </div>
        </div>

        <!-- B. ä¸‹è½½æ‰“å°å¼¹çª— (Download Modal) -->
        <div id="download-modal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
                onclick="toggleModal('download-modal')"></div>
            <div
                class="absolute bottom-0 w-full bg-white rounded-t-3xl p-6 modal-enter max-w-md mx-auto left-0 right-0">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-gray-800">ç”Ÿæˆç»ƒä¹ å·</h3>
                    <button onclick="toggleModal('download-modal')" class="text-gray-400 hover:text-gray-600"><i
                            data-lucide="x" class="icon-base"></i></button>
                </div>

                <div class="space-y-6">
                    <!-- è¯•é¢˜é€‰æ‹© -->
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-bold text-gray-700">é€‰æ‹©è¯•é¢˜</span>
                            <button class="text-xs text-[#09C0D7] font-bold">å…¨é€‰ (57)</button>
                        </div>
                        <div class="text-xs text-gray-500">å·²é€‰ä¸­å½“å‰åˆ—è¡¨ä¸­çš„ <span class="font-bold text-gray-800">12</span> é“é”™é¢˜
                        </div>
                    </div>

                    <!-- å¯¼å‡ºè®¾ç½® -->
                    <div class="space-y-3">
                        <label class="text-sm font-bold text-gray-700">å¯¼å‡ºå†…å®¹è®¾ç½®</label>

                        <label class="flex items-center justify-between p-3 border border-gray-100 rounded-lg">
                            <span class="text-sm text-gray-600">ä»…åŒ…å«åŸé”™é¢˜</span>
                            <input type="checkbox" checked class="w-5 h-5 accent-[#09C0D7] rounded">
                        </label>

                        <label class="flex items-center justify-between p-3 border border-gray-100 rounded-lg">
                            <div class="flex flex-col">
                                <span class="text-sm text-gray-600">åŒ…å«AIå˜å¼é¢˜</span>
                                <span class="text-[10px] text-gray-400">æ¯é“é”™é¢˜ç”ŸæˆåŒç±»é¢˜</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-bold text-gray-500">x 1</span>
                                <input type="checkbox" class="w-5 h-5 accent-[#09C0D7] rounded">
                            </div>
                        </label>

                        <label class="flex items-center justify-between p-3 border border-gray-100 rounded-lg">
                            <span class="text-sm text-gray-600">åŒ…å«è§£æä¸ç­”æ¡ˆ</span>
                            <input type="checkbox" class="w-5 h-5 accent-[#09C0D7] rounded">
                        </label>
                    </div>

                    <button onclick="toggleModal('download-modal'); window.parent.postMessage({
                                type: 'SWITCH_TAB',
                                index: 3
                            }, '*');"
                        class="w-full py-3.5 rounded-xl bg-[#09C0D7] text-white font-bold text-sm shadow-lg shadow-cyan-100 flex items-center justify-center gap-2">
                        <i data-lucide="file-down" class="icon-small"></i> ç«‹å³å¯¼å‡º PDF
                    </button>
                </div>
            </div>
        </div>

        <!-- C. AI ç­”ç–‘å¼¹çª— (AI QA Modal) -->
        <div id="ai-qa-modal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
                onclick="toggleModal('ai-qa-modal')"></div>
            <div
                class="absolute bottom-0 w-full bg-white rounded-t-3xl p-6 modal-enter max-w-md mx-auto left-0 right-0 h-[70vh] flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <div class="bg-indigo-100 p-2 rounded-full">
                            <i data-lucide="bot" class="w-5 h-5 text-indigo-600"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800">AI ç­”ç–‘åŠ©æ‰‹</h3>
                    </div>
                    <button onclick="toggleModal('ai-qa-modal')" class="text-gray-400 hover:text-gray-600"><i
                            data-lucide="x" class="icon-base"></i></button>
                </div>

                <div class="flex-1 overflow-y-auto scrollbar-hide space-y-4 bg-gray-50 rounded-xl p-4 mb-4">
                    <!-- Chat Content -->
                    <div class="flex gap-3">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="bot" class="w-4 h-4 text-indigo-600"></i>
                        </div>
                        <div
                            class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-gray-700 leading-relaxed">
                            ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIå­¦ä¹ åŠ©æ‰‹ã€‚å…³äºè¿™é“é¢˜ï¼Œä½ æœ‰ä»€ä¹ˆæƒ³é—®çš„å—ï¼Ÿæˆ‘å¯ä»¥ä¸ºä½ è®²è§£çŸ¥è¯†ç‚¹ï¼Œæˆ–è€…ä¸¾å‡ ä¸ªç±»ä¼¼çš„ä¾‹å­ã€‚
                        </div>
                    </div>

                    <div class="flex gap-3 flex-row-reverse">
                        <div class="w-8 h-8 rounded-full bg-[#09C0D7] flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-xs font-bold">æˆ‘</span>
                        </div>
                        <div
                            class="bg-[#09C0D7] p-3 rounded-2xl rounded-tr-none shadow-sm text-sm text-white leading-relaxed">
                            è¿™é“é¢˜æˆ‘ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆé€‰Bï¼Œèƒ½è¯¦ç»†è®²è®²å—ï¼Ÿ
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="bot" class="w-4 h-4 text-indigo-600"></i>
                        </div>
                        <div
                            class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-gray-700 leading-relaxed">
                            <p class="mb-2">å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™é“é¢˜ã€‚</p>
                            <p class="mb-2">é¢˜ç›®é—®çš„æ˜¯"happy"ï¼ˆå¿«ä¹ï¼‰çš„åŒä¹‰è¯ã€‚</p>
                            <ul class="list-disc pl-4 space-y-1 text-gray-600">
                                <li><strong>A. Angry</strong> æ„æ€æ˜¯â€œç”Ÿæ°”çš„â€</li>
                                <li><strong>B. Glad</strong> æ„æ€æ˜¯â€œé«˜å…´çš„â€ï¼Œä¸ happy åŒä¹‰</li>
                                <li><strong>C. Sad</strong> æ„æ€æ˜¯â€œæ‚²ä¼¤çš„â€</li>
                                <li><strong>D. Tired</strong> æ„æ€æ˜¯â€œç–²æƒ«çš„â€</li>
                            </ul>
                            <p class="mt-2">æ‰€ä»¥æ­£ç¡®ç­”æ¡ˆæ˜¯ Bã€‚è®°ä½äº†å—ï¼ŸGlad = Happyï¼</p>
                        </div>
                    </div>
                </div>

                <div class="relative">
                    <input type="text" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
                        class="w-full py-3 pl-4 pr-12 rounded-xl border border-gray-200 focus:border-[#09C0D7] focus:ring-2 focus:ring-[#09C0D7]/20 outline-none transition-all">
                    <button
                        class="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-[#09C0D7] text-white rounded-lg hover:bg-[#08acc0]">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Gemini API (Keep Mock for demo) ---
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- æ•°æ®: å¢åŠ æ›´å¤šå­—æ®µ ---
        const MOCK_MISTAKES = [
            {
                id: 1,
                subject: 'è¯­æ–‡',
                type: 'åˆ¤æ–­é¢˜',
                difficulty: 4,
                status: 'new',
                content: 'æˆ‘çŸ¥é“æœ¬æ–‡ï¼ˆã€Šå¤§é’æ ‘ä¸‹çš„å°å­¦ã€‹ï¼‰ç¬¬3è‡ªç„¶æ®µå†™çš„æ˜¯åŒå­¦ä»¬è¯¾ä¸Šè®¤çœŸè¯»ä¹¦å’Œè¯¾ä¸‹å°½æƒ…ç©è€çš„åœºæ™¯ã€‚',
                userAnswer: 'âˆš',
                correctAnswer: 'Ã—',
                reason: 'æ¦‚å¿µæœªæŒæ¡', // é”™å› 
                errorRate: '85%',     // å‡ºé”™ç‡
                analysis: 'ç¬¬3è‡ªç„¶æ®µä¸»è¦æå†™äº†ä¸‹è¯¾åçš„åœºæ™¯ï¼Œè¯¾ä¸Šçš„æå†™åœ¨ç¬¬2è‡ªç„¶æ®µã€‚æ­¤å¤„æ˜¯è€ƒå¯Ÿå¯¹è¯¾æ–‡æ®µè½ä¸»æ—¨çš„ç†è§£ã€‚',
                videoTitle: 'å…³è”å¾®è¯¾ï¼šæ®µè½åœºæ™¯åˆ†æ'
            },
            {
                id: 2,
                subject: 'æ•°å­¦',
                type: 'è®¡ç®—é¢˜',
                difficulty: 5,
                status: 'new',
                content: 'è®¡ç®— $ \\frac{1}{2} + \\frac{1}{3} + \\frac{1}{6} $ çš„ç»“æœï¼Œå¹¶å†™å‡ºä¸»è¦æ­¥éª¤ã€‚',
                userAnswer: '1',
                correctAnswer: '1',
                reason: 'æ­¥éª¤é—æ¼',
                errorRate: '60%',
                analysis: 'è™½ç„¶ç»“æœæ­£ç¡®ï¼Œä½†æœªå†™å‡ºé€šåˆ†çš„æ­¥éª¤ã€‚æ­£ç¡®çš„æ­¥éª¤åº”æ˜¯ $\\frac{3}{6} + \\frac{2}{6} + \\frac{1}{6} = \\frac{6}{6} = 1$ã€‚',
                videoTitle: 'å…³è”å¾®è¯¾ï¼šåˆ†æ•°åŠ æ³•ä¸é€šåˆ†'
            },
            {
                id: 3,
                subject: 'è‹±è¯­',
                type: 'é€‰æ‹©é¢˜',
                difficulty: 3,
                status: 'mastered',
                content: 'Which word means "happy"? A. Angry B. Glad C. Sad D. Tired',
                userAnswer: 'A',
                correctAnswer: 'B',
                reason: 'é©¬è™ç²—å¿ƒ',
                errorRate: '25%',
                analysis: 'Glad (adj.) æ„ä¸ºé«˜å…´çš„ï¼Œå¿«ä¹çš„ã€‚A. Angry (ç”Ÿæ°”çš„)ï¼›C. Sad (æ‚²ä¼¤çš„)ï¼›D. Tired (ç–²æƒ«çš„)ã€‚',
                videoTitle: 'å…³è”å¾®è¯¾ï¼šå¸¸ç”¨æƒ…ç»ªå½¢å®¹è¯'
            },
            {
                id: 4,
                subject: 'è¯­æ–‡',
                type: 'å¡«ç©ºé¢˜',
                difficulty: 3,
                status: 'new',
                content: 'çœ‹å›¾å¡«ç©ºï¼šç¾Šç¾¤ $\\to$ [      ] $\\to$ ç™½è‰²çš„èŠ±',
                img: 'https://placehold.co/300x100/e0f2f1/00796b?text=Diagram+Placeholder',
                userAnswer: 'è‰åœ°',
                correctAnswer: 'ç™½è‰²çš„å¤§èŠ±',
                reason: 'å®¡é¢˜ä¸æ¸…',
                errorRate: '40%',
                analysis: 'æ ¹æ®è¯¾æ–‡æ¯”å–»å¥â€œç¾Šç¾¤ä¸€ä¼šå„¿ä¸Šäº†å°ä¸˜...åƒç»™æ— è¾¹çš„ç»¿æ¯¯ç»£ä¸Šäº†ç™½è‰²çš„å¤§èŠ±â€ï¼Œæœ¬ä½“æ˜¯ç¾Šç¾¤ï¼Œå–»ä½“æ˜¯ç™½è‰²çš„å¤§èŠ±ã€‚',
                videoTitle: 'å…³è”å¾®è¯¾ï¼šæ¯”å–»å¥è§£æ'
            }
        ];

        let currentActiveTab = 'new';
        let currentSubjectFilter = 'è¯­æ–‡'; // é»˜è®¤ç¬¬ä¸€ä¸ªå­¦ç§‘

        // çŠ¶æ€é¢œè‰²æ˜ å°„
        const statusMap = {
            new: { label: 'å¾…æ”»å…‹', color: 'bg-red-50 text-red-600 border-red-100' },
            mastered: { label: 'å·²æŒæ¡', color: 'bg-green-50 text-green-600 border-green-100' }
        };

        // é”™å› é¢œè‰²æ˜ å°„
        const reasonColorMap = {
            'æ¦‚å¿µæœªæŒæ¡': 'bg-purple-50 text-purple-600 border-purple-100',
            'æ­¥éª¤é—æ¼': 'bg-orange-50 text-orange-600 border-orange-100',
            'é©¬è™ç²—å¿ƒ': 'bg-gray-50 text-gray-600 border-gray-200',
            'å®¡é¢˜ä¸æ¸…': 'bg-blue-50 text-blue-600 border-blue-100',
            'default': 'bg-gray-50 text-gray-500'
        };

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function generateDifficultyStars(difficulty) {
            let starsHtml = '';
            for (let i = 0; i < 5; i++) {
                const colorClass = i < difficulty ? "text-orange-400 fill-orange-400" : "text-gray-200";
                starsHtml += `<i data-lucide="star" class="icon-small ${colorClass}"></i>`;
            }
            return starsHtml;
        }

        function generateMistakeCard(data) {
            const { id, subject, type, difficulty, status, content, img, userAnswer, correctAnswer, analysis, videoTitle, reason, errorRate } = data;
            const statusInfo = statusMap[status];
            const reasonClass = reasonColorMap[reason] || reasonColorMap['default'];

            return `
            <div id="card-${id}" onclick="window.location.href='jsx_wrong_detail.html?id=${id}'" class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden fade-in relative group transition-all duration-200 cursor-pointer">
                <!-- å¡ç‰‡å¤´éƒ¨ -->
                <div class="px-4 py-3 flex justify-between items-start border-b border-gray-50 bg-gray-50/30">
                    <div class="flex gap-2 items-center">
                        <span class="text-[10px] px-2 py-0.5 rounded-md border font-bold ${statusInfo.color}">
                            ${statusInfo.label}
                        </span>
                        <span class="text-xs text-gray-500 font-medium">${subject} Â· ${type}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded">${errorRate}å­¦ç”Ÿåšé”™</span>
                        <div class="flex gap-0.5">${generateDifficultyStars(difficulty)}</div>
                    </div>
                </div>

                <!-- é¢˜ç›®å†…å®¹åŒº -->
                <div class="p-4">
                    <div class="flex gap-2 mb-2 flex-wrap">
                        <span class="text-[10px] px-2 py-0.5 rounded border ${reasonClass} font-medium">
                           #${reason}
                        </span>
                    </div>
                    <div class="text-sm text-gray-800 font-medium leading-relaxed">
                        ${content}
                    </div>
                    
                    ${img ? `<div class="mt-3 rounded-lg overflow-hidden border border-gray-100"><img src="${img}" class="w-full h-auto object-cover"></div>` : ''}

                    <!-- é®æŒ¡ç­”æ¡ˆåŒº -->
                    <div class="mt-4 relative">
                        <div id="analysis-hidden-${id}">
                            <button onclick="toggleAnalysis('${id}')" class="w-full py-6 bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl text-gray-400 text-xs flex flex-col items-center justify-center gap-2 hover:bg-gray-100 transition-colors active:scale-[.98]">
                                <span class="font-bold text-gray-500">ğŸ‘€ æ€è€ƒä¸€ä¸‹</span>
                                <span>ç‚¹å‡»æŸ¥çœ‹è§£æä¸ç­”æ¡ˆ</span>
                            </button>
                        </div>

                        <div id="analysis-visible-${id}" class="hidden fade-in">
                            <div class="bg-cyan-50/40 rounded-xl p-3 border border-cyan-100/50">
                                <div class="flex justify-between text-xs mb-2 pb-2 border-b border-cyan-100/50">
                                    <span class="text-red-500 font-medium">âŒ ä½ çš„ç­”æ¡ˆ: ${userAnswer}</span>
                                    <span class="text-green-600 font-bold">âœ… æ­£ç¡®ç­”æ¡ˆ: ${correctAnswer}</span>
                                </div>
                                <div class="text-xs text-gray-600 leading-relaxed mb-3">
                                    <span class="font-bold text-[#09C0D7]">ã€è§£æã€‘</span> ${analysis}
                                </div>
                                <div class="flex items-center gap-2 bg-white p-2 rounded-lg border border-gray-100 cursor-pointer hover:border-cyan-200">
                                    <i data-lucide="play-circle" class="icon-base text-[#09C0D7]"></i>
                                    <div>
                                        <div class="text-xs font-bold text-gray-800">${videoTitle}</div>
                                        <div class="text-[10px] text-gray-400">03:45 Â· 320äººå­¦ä¹ </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- è®¢æ­£åŒº (æ–°å¢åŠŸèƒ½) -->
                            <div class="mt-3 flex gap-2">
                                <button onclick="alert('è°ƒèµ·ç›¸æœºè®¢æ­£'); event.stopPropagation();" class="flex-1 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs font-bold text-gray-600 flex items-center justify-center gap-1.5 active:scale-95 transition-transform">
                                    <i data-lucide="camera" class="icon-small"></i> ä¸Šä¼ è®¢æ­£
                                </button>
                                <button onclick="toggleAnalysis('${id}', false)" class="px-3 text-xs text-gray-400 underline">æ”¶èµ·</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨æ“ä½œæ  -->
                <div class="grid grid-cols-3 border-t border-gray-100 divide-x divide-gray-100 bg-gray-50/30">
                    <button onclick="event.stopPropagation(); openAIQA('${id}')" class="p-3 flex items-center justify-center gap-2 text-xs font-bold text-indigo-600 hover:bg-indigo-50 active:bg-indigo-100 transition-colors">
                        <i data-lucide="bot" class="icon-small"></i> AI ç­”ç–‘
                    </button>
                    <button onclick="event.stopPropagation(); previewPaper()" class="p-3 flex items-center justify-center gap-2 text-xs font-bold text-gray-600 hover:bg-gray-50 active:bg-gray-200 transition-colors">
                        <i data-lucide="refresh-cw" class="icon-small text-orange-500"></i> ä¸¾ä¸€åä¸‰
                    </button>
                    <button onclick="event.stopPropagation()" class="p-3 flex items-center justify-center gap-2 text-xs font-bold text-[#09C0D7] hover:bg-cyan-50 active:bg-cyan-100 transition-colors">
                        <i data-lucide="check-circle" class="icon-small"></i> æ ‡è®°å·²æŒæ¡
                    </button>
                </div>
            </div>
        `;
        }

        function toggleAnalysis(id, show = true) {
            event.stopPropagation();
            const hidden = document.getElementById(`analysis-hidden-${id}`);
            const visible = document.getElementById(`analysis-visible-${id}`);
            if (show) {
                hidden.classList.add('hidden');
                visible.classList.remove('hidden');
            } else {
                hidden.classList.remove('hidden');
                visible.classList.add('hidden');
            }
        }

        function toggleSelection(id) {
            const card = document.getElementById(`card-${id}`);
            card.classList.toggle('card-selected');
        }

        function openAIQA(id) {
            toggleModal('ai-qa-modal');
        }

        // --- å­¦ç§‘åˆ‡æ¢ Logic ---
        function initPage() {
            lucide.createIcons();

            // åˆå§‹åŒ–åŸºç¡€ç»„ä»¶ï¼šå­¦ç§‘åˆ‡æ¢
            new SubjectSwitcher({
                containerId: 'subject-tabs-container',
                subjects: ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­', 'ç‰©ç†'],
                initialSubject: currentSubjectFilter,
                onChange: (subject) => {
                    currentSubjectFilter = subject;
                    renderMistakeList();
                }
            });

            renderTabs();
            renderMistakeList();
        }

        // --- Tab æ¸²æŸ“ (ç¾åŒ–ç‰ˆ) ---
        function renderTabs() {
            const tabContainer = document.getElementById('tab-container');
            tabContainer.innerHTML = '';

            const tabs = [
                { id: 'new', label: 'å¾…æ”»å…‹' },
                { id: 'mastered', label: 'å·²æŒæ¡' }
            ];

            tabs.forEach(tab => {
                const isActive = tab.id === currentActiveTab;
                const btn = document.createElement('button');
                // Segmented Control Style
                btn.className = `flex-1 py-2 text-xs font-bold rounded-lg transition-all duration-300 ${isActive
                    ? 'bg-[#09C0D7] text-white shadow-md shadow-cyan-100 scale-100'
                    : 'text-gray-500 hover:bg-gray-50'
                    }`;
                btn.textContent = tab.label;
                btn.onclick = () => {
                    currentActiveTab = tab.id;
                    renderTabs();
                    renderMistakeList();
                };
                tabContainer.appendChild(btn);
            });
        }

        // --- ç­›é€‰ä¸æ¸²æŸ“é€»è¾‘ ---
        // (applyFilters removed as we now use specific subject tabs logic)

        function renderMistakeList() {
            const listContainer = document.getElementById('mistake-list');
            listContainer.innerHTML = '';

            const filtered = MOCK_MISTAKES.filter(m => {
                // Tab Filter
                if (currentActiveTab === 'new' && m.status !== 'new') return false;
                if (currentActiveTab === 'mastered' && m.status !== 'mastered') return false;

                // Subject Filter (Strict)
                if (m.subject !== currentSubjectFilter) return false;

                return true;
            });

            if (filtered.length === 0) {
                listContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center py-10 text-gray-400">
                    <i data-lucide="inbox" class="w-12 h-12 mb-2 opacity-50"></i>
                    <p class="text-xs">æš‚æ— ç›¸å…³é”™é¢˜</p>
                </div>
            `;
            } else {
                filtered.forEach(item => {
                    listContainer.insertAdjacentHTML('beforeend', generateMistakeCard(item));
                });
            }
            lucide.createIcons();
        }

        // --- å¼¹çª—é€»è¾‘ ---
        window.toggleModal = function (modalId) {
            const modal = document.getElementById(modalId);
            const isHidden = modal.classList.contains('hidden');
            
            if (isHidden) {
                modal.classList.remove('hidden');
                // é€šçŸ¥çˆ¶é¡µé¢å¼¹çª—å·²æ‰“å¼€ï¼Œæé«˜ iframe å±‚çº§
                window.parent.postMessage({ type: 'SET_MODAL_ACTIVE', active: true }, '*');
            } else {
                modal.classList.add('hidden');
                // é€šçŸ¥çˆ¶é¡µé¢å¼¹çª—å·²å…³é—­ï¼Œæ¢å¤ iframe å±‚çº§
                window.parent.postMessage({ type: 'SET_MODAL_ACTIVE', active: false }, '*');
            }
        }

        // ä¸¾ä¸€åä¸‰
        function previewPaper() {
            // è·³è½¬åˆ°ä¸¾ä¸€åä¸‰é¡µé¢
            window.location.href = 'jsx_paper_preview.html';
        }

        // æ”¶é›†é”™é¢˜
        function collectWrong() {
            // è·³è½¬åˆ°é”™é¢˜é‡‡é›†é¡µ
            window.location.href = 'jsx_collect_wrong.html';
        }

        // --- Filter Chip Component Helper ---
        class FilterChipElement extends HTMLElement {
            connectedCallback() {
                const label = this.getAttribute('label');
                const active = this.hasAttribute('active');
                this.innerHTML = `
                <button class="px-3 py-1.5 rounded-full text-xs font-bold border transition-colors ${active
                        ? 'bg-cyan-50 text-[#09C0D7] border-[#09C0D7]'
                        : 'bg-white text-gray-500 border-gray-200 hover:border-gray-300'
                    }">
                    ${label}
                </button>
            `;
                this.querySelector('button').onclick = (e) => {
                    // Simple toggle visual for demo
                    const btn = e.target.closest('button');
                    if (btn.classList.contains('bg-cyan-50')) {
                        btn.className = 'px-3 py-1.5 rounded-full text-xs font-bold border transition-colors bg-white text-gray-500 border-gray-200 hover:border-gray-300';
                    } else {
                        btn.className = 'px-3 py-1.5 rounded-full text-xs font-bold border transition-colors bg-cyan-50 text-[#09C0D7] border-[#09C0D7]';
                    }
                };
            }
        }
        customElements.define('filter-chip', FilterChipElement);

        // åˆå§‹åŒ–
        window.onload = initPage;
    </script>

</body>

</html>