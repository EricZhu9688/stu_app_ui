<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧学习导航仪 - 首页</title>
    <script src="js/tailwind.min.js"></script>
    <script src="js/lucide.js"></script>
    <style>
        /* 1. 进阶活力主题色与样式调整 */
        :root {
            --primary-cyan: #00bcd4;
            /* Main Cyan Color */
            --primary-cyan-dark: #00acc1;
            --accent-yellow: #ffc107;
            --bg-gray: #f5f7fa;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-gray);
        }

        /* Custom Shapes */
        .header-bg {
            background: linear-gradient(180deg, #26c6da 0%, #00bcd4 100%);
            border-bottom-left-radius: 2rem;
            border-bottom-right-radius: 2rem;
            padding-bottom: 4rem;
            /* Space for overlap */
        }

        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Hide scrollbar for horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes slide-up {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }
    </style>
</head>

<body class="pb-24" onload="initIcons()">

    <!-- Header Section -->
    <header class="header-bg pt-6 pb-16 px-6 relative z-10">
        <!-- Top Bar -->
        <div class="flex justify-between items-center mb-6">
            <!-- Grade Selector -->
            <!-- Grade Selector -->
            <button onclick="openGradeModal()"
                class="flex items-center space-x-1 bg-white/20 backdrop-blur-sm px-3 py-1.5 rounded-full text-white font-bold text-sm">
                <span id="current-grade-text">六年级 (上)</span>
                <i data-lucide="chevron-down" class="w-4 h-4"></i>
            </button>

            <!-- Notification -->
            <button class="relative p-2 bg-white/20 backdrop-blur-sm rounded-full text-white">
                <i data-lucide="bell" class="w-5 h-5"></i>
                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full border border-white"></span>
            </button>
        </div>

        <!-- User Info Row -->
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <!-- Avatar -->
                <div class="relative">
                    <div class="w-16 h-16 rounded-full border-2 border-white overflow-hidden bg-yellow-200">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar"
                            class="w-full h-full">
                    </div>

                </div>

                <!-- Name & Status -->
                <div class="text-white">
                    <div class="flex items-center space-x-2 mb-1">
                        <h1 class="text-2xl font-bold" id="current-student-name">张小明</h1>
                        <button onclick="openSwitchChildModal()"
                            class="flex items-center space-x-1 bg-white/20 px-2 py-0.5 rounded-full text-xs hover:bg-white/30 transition">
                            <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                            <span>切换孩子</span>
                        </button>
                    </div>
                    <p class="text-sm opacity-90">今日还剩 3 项任务，加油！</p>
                </div>
            </div>

            <!-- Accuracy Card -->
            <div class="glass-card p-3 rounded-xl text-white text-center min-w-[80px]">
                <p class="text-xs opacity-80 mb-1">本周准确率</p>
                <p class="text-2xl font-bold">92%</p>
            </div>
        </div>
    </header>

    <!-- Main Content (Overlapping) -->
    <main class="px-4 -mt-10 relative z-20">

        <!-- Quick Services (Moved to Top) -->
        <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-4">快速服务</h3>
            <div class="grid grid-cols-2 gap-3">
                <!-- Service 1 -->
                <div onclick="goToErrorBook()" class="bg-white p-4 rounded-2xl card-shadow flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500">
                        <i data-lucide="book-x" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-800 text-sm">收集错题</p>
                        <p class="text-xs text-gray-400">待消灭 12 题</p>
                    </div>
                </div>
                <!-- Service 2 -->
                <div onclick="viewLatestReport()"
                    class="bg-white p-4 rounded-2xl card-shadow flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center text-blue-500">
                        <i data-lucide="pie-chart" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-800 text-sm">学情报告</p>
                        <p class="text-xs text-gray-400">周报更新</p>
                    </div>
                </div>
                <!-- Service 3 -->
                <div onclick="goToIncentiveCenter()"
                    class="bg-white p-4 rounded-2xl card-shadow flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-purple-50 flex items-center justify-center text-purple-500">
                        <i data-lucide="gem" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-800 text-sm">积分乐园(暂不做)</p>
                        <p class="text-xs text-gray-400">2400 币</p>
                    </div>
                </div>
                <!-- Service 4 -->
                <div onclick="goToResourceCenter()"
                    class="bg-white p-4 rounded-2xl card-shadow flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-green-50 flex items-center justify-center text-green-500">
                        <i data-lucide="layers" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-800 text-sm">基础资源</p>
                        <p class="text-xs text-gray-400">教辅答案/听力</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Smart Toolbox (Middle) -->
        <div class="bg-white rounded-3xl p-5 card-shadow mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i data-lucide="wand-2" class="w-5 h-5 text-cyan-500"></i>
                AI智能体
            </h3>
            <div class="grid grid-cols-5 gap-2">
                <button onclick="goToAITool('作文批改')" class="flex flex-col items-center space-y-2">
                    <div class="w-12 h-12 rounded-full bg-pink-100 flex items-center justify-center">
                        <i data-lucide="pen-tool" class="w-6 h-6 text-pink-500"></i>
                    </div>
                    <span class="text-xs text-gray-600">作文批改</span>
                </button>
                <button onclick="goToAITool('口算批改')" class="flex flex-col items-center space-y-2">
                    <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                        <i data-lucide="calculator" class="w-6 h-6 text-green-500"></i>
                    </div>
                    <span class="text-xs text-gray-600">口算批改</span>
                </button>
                <button onclick="goToAITool('拍照答疑')" class="flex flex-col items-center space-y-2">
                    <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center">
                        <i data-lucide="camera" class="w-6 h-6 text-orange-500"></i>
                    </div>
                    <span class="text-xs text-gray-600">拍照答疑</span>
                </button>
                <button onclick="goToAITool('拍照翻译')" class="flex flex-col items-center space-y-2">
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                        <i data-lucide="camera" class="w-6 h-6 text-blue-500"></i>
                    </div>
                    <span class="text-xs text-gray-600">拍照翻译</span>
                </button>
                <button onclick="goToAITool('手写擦除')" class="flex flex-col items-center space-y-2">
                    <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center">
                        <i data-lucide="eraser" class="w-6 h-6 text-orange-500"></i>
                    </div>
                    <span class="text-xs text-gray-600">手写擦除</span>
                </button>
            </div>
        </div>

        <!-- Recent Recommendations (Formerly Task Section) (Bottom) -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-base font-bold text-gray-800">近期推荐</h3>
                <button onclick="toggleNoHomework()"
                    class="flex items-center space-x-1 bg-gray-200 text-gray-600 px-2 py-1 rounded text-xs">
                    <i data-lucide="refresh-ccw" class="w-3 h-3"></i>
                    <span>模拟: 切换无作业状态</span>
                </button>
            </div>

            <div class="flex items-center space-x-4 mb-4 border-b border-gray-100">
                <button id="tab-today" class="text-lg font-bold text-gray-800 border-b-2 border-cyan-500 pb-2"
                    onclick="switchTaskTab('today')">今日任务</button>
                <button id="tab-week" class="text-lg text-gray-400 pb-2" onclick="switchTaskTab('week')">本周计划</button>
            </div>

            <!-- Task List Content -->
            <div id="today-tasks-list">
                <!-- Task 1 -->
                <div class="bg-white rounded-2xl p-4 card-shadow mb-3 flex justify-between items-center">
                    <div class="flex items-start space-x-3">
                        <div class="w-1 bg-red-400 h-10 rounded-full mt-1"></div>
                        <div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="bg-red-100 text-red-500 text-xs px-1.5 py-0.5 rounded">必做</span>
                                <span class="text-gray-500 text-xs">数学 · 分数乘法</span>
                            </div>
                            <h4 class="font-bold text-gray-800">专项强化练习卷 A</h4>
                            <div class="flex items-center mt-1 space-x-2">
                                <span class="text-xs text-orange-500 bg-orange-50 px-1.5 rounded flex items-center">
                                    <i data-lucide="coins" class="w-3 h-3 mr-1"></i> +50 金币
                                </span>
                            </div>
                        </div>
                    </div>
                    <button onclick="goToErrorBook()"
                        class="bg-red-400 text-white px-4 py-2 rounded-full text-sm font-bold shadow-md shadow-red-200">去完成</button>
                </div>

                <!-- Task 2 -->
                <div class="bg-white rounded-2xl p-4 card-shadow mb-3 flex justify-between items-center">
                    <div class="flex items-start space-x-3">
                        <div class="w-1 bg-cyan-400 h-10 rounded-full mt-1"></div>
                        <div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="bg-cyan-100 text-cyan-600 text-xs px-1.5 py-0.5 rounded">选做</span>
                                <span class="text-gray-500 text-xs">语文 · 阅读</span>
                            </div>
                            <h4 class="font-bold text-gray-800">课外阅读打卡 30分钟</h4>
                        </div>
                    </div>
                    <button onclick="goToResourceCenter()"
                        class="bg-cyan-400 text-white px-4 py-2 rounded-full text-sm font-bold shadow-md shadow-cyan-200">去阅读</button>
                </div>
            </div>

            <!-- Week Tasks (Placeholder) -->
            <div id="week-tasks-list"
                class="hidden text-center p-8 bg-white rounded-2xl border border-gray-200 card-shadow">
                <i data-lucide="calendar" class="w-10 h-10 mx-auto mb-3 text-cyan-500"></i>
                <p class="text-lg font-bold text-gray-700">本周计划加载中...</p>
                <p class="text-sm text-gray-500 mt-2">这里将展示您的学科长期目标、待完成的章节测试以及平台推荐的进阶资源。</p>
            </div>

            <!-- No Homework State (Hidden by default) -->
            <div id="no-task-today" class="hidden bg-white rounded-3xl p-8 card-shadow text-center">
                <div class="w-24 h-24 bg-gray-50 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <img src="https://cdn-icons-png.flaticon.com/512/744/744922.png" alt="Party"
                        class="w-16 h-16 opacity-80">
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">太棒了，今日任务已清空！</h3>
                <p class="text-sm text-gray-500 mb-6">保持好习惯，利用空闲时间巩固一下薄弱点吧。</p>
                <div class="flex justify-center space-x-4">
                    <button onclick="goToErrorBook()"
                        class="border border-cyan-400 text-cyan-500 px-6 py-2 rounded-full font-bold text-sm">查看错题</button>
                    <button onclick="goToResourceCenter()"
                        class="bg-cyan-400 text-white px-6 py-2 rounded-full font-bold text-sm shadow-md shadow-cyan-200">自主练习</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Switch Child Modal -->
    <div id="switch-child-modal"
        class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm transition-opacity"
        onclick="if(event.target === this) closeSwitchChildModal()">
        <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 animate-slide-up">
            <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <h3 class="text-xl font-bold text-center text-gray-800 mb-6">切换当前学生</h3>

            <div class="space-y-3 mb-6">
                <!-- Case 1: School + Class (Current) -->
                <div class="border-2 border-cyan-400 bg-cyan-50 rounded-2xl p-3 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"
                                class="w-12 h-12 rounded-full bg-white">
                            <div class="absolute -bottom-1 -right-1 bg-green-500 text-white text-[10px] px-1.5 py-0.5 rounded-full border border-white">在读</div>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-cyan-600">张小明 (当前)</span>
                            </div>
                            <p class="text-xs text-gray-500">演示学校 · 六年级2班</p>
                        </div>
                    </div>
                    <div class="w-6 h-6 bg-cyan-400 rounded-full flex items-center justify-center text-white">
                        <i data-lucide="check" class="w-4 h-4"></i>
                    </div>
                </div>

                <!-- Case 2: School Only (No Class) -->
                <div onclick="switchStudent('张小红')"
                    class="border border-gray-100 rounded-2xl p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Annie"
                                class="w-12 h-12 rounded-full bg-gray-100">
                            <div class="absolute -bottom-1 -right-1 bg-blue-400 text-white text-[10px] px-1.5 py-0.5 rounded-full border border-white">未分班</div>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-gray-800">张小红</span>
                            </div>
                            <p class="text-xs text-gray-500">演示学校 · 暂无班级信息</p>
                        </div>
                    </div>
                </div>

                <!-- Case 3: No School -->
                <div onclick="switchStudent('王小刚')"
                    class="border border-gray-100 rounded-2xl p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Bob"
                                class="w-12 h-12 rounded-full bg-gray-100">
                            <div class="absolute -bottom-1 -right-1 bg-gray-400 text-white text-[10px] px-1.5 py-0.5 rounded-full border border-white">未加入</div>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-gray-800">王小刚</span>
                            </div>
                            <p class="text-xs text-gray-500">暂无学校信息</p>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="window.location.href='jsx_bind_student.html'"
                class="w-full py-3 border border-dashed border-gray-300 rounded-xl text-gray-400 font-bold flex items-center justify-center hover:bg-gray-50 hover:border-gray-400 transition">
                <i data-lucide="plus" class="w-5 h-5 mr-1"></i> 绑定新孩子
            </button>
        </div>
    </div>
    <!-- Grade Switch Modal -->
    <div id="grade-switch-modal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm transition-opacity">
        <div class="bg-white w-full max-w-md rounded-3xl p-6 relative m-4 animate-slide-up">
            <!-- Header -->
            <button onclick="closeGradeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <!-- System Toggle -->
            <div class="flex justify-center mb-6">
                <div class="flex bg-red-50 rounded-lg p-1">
                    <button id="sys-63" onclick="toggleSystem('63')"
                        class="px-8 py-2 rounded-md text-sm font-bold bg-cyan-500 text-white shadow-sm transition-all">六三制</button>
                    <button id="sys-54" onclick="toggleSystem('54')"
                        class="px-8 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition-all">五四制</button>
                </div>
            </div>

            <!-- Content -->
            <div class="space-y-5 max-h-[60vh] overflow-y-auto no-scrollbar">
                <!-- Primary -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <div class="w-1 h-4 bg-cyan-500 rounded-full"></div>
                        <h4 class="font-bold text-gray-800 text-lg">小学</h4>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="selectGrade('一年级', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">一年级</button>
                        <button onclick="selectGrade('二年级', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">二年级</button>
                        <button onclick="selectGrade('三年级', this)"
                            class="grade-btn bg-cyan-50 border border-cyan-500 rounded-lg py-2.5 text-sm text-cyan-500 font-bold transition-colors">三年级</button>
                        <button onclick="selectGrade('四年级', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">四年级</button>
                        <button onclick="selectGrade('五年级', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">五年级</button>
                        <button onclick="selectGrade('六年级', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">六年级</button>
                    </div>
                </div>
                <!-- Middle -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <div class="w-1 h-4 bg-cyan-500 rounded-full"></div>
                        <h4 class="font-bold text-gray-800 text-lg">初中</h4>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="selectGrade('初一', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">初一</button>
                        <button onclick="selectGrade('初二', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">初二</button>
                        <button onclick="selectGrade('初三', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">初三</button>
                    </div>
                </div>
                <!-- High -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <div class="w-1 h-4 bg-cyan-500 rounded-full"></div>
                        <h4 class="font-bold text-gray-800 text-lg">高中</h4>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="selectGrade('高一', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">高一</button>
                        <button onclick="selectGrade('高二', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">高二</button>
                        <button onclick="selectGrade('高三', this)"
                            class="grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors">高三</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化 Lucide 图标
        function initIcons() {
            lucide.createIcons();
        }

        // 模拟页面跳转
        function showMessage(title) {
            const message = document.createElement('div');
            message.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            message.innerHTML = `
                <div class="bg-white p-6 rounded-2xl shadow-2xl max-w-sm w-full text-center">
                    <p class="text-xl font-bold text-cyan-500 mb-3">${title}</p>
                    <p class="text-sm text-gray-600">这是模拟的页面跳转。</p>
                    <button onclick="this.parentNode.parentNode.remove()" class="mt-4 bg-cyan-500 text-white px-4 py-2 rounded-lg interactive-button shadow-md hover:bg-cyan-600">
                        确定
                    </button>
                </div>
            `;
            document.body.appendChild(message);
        }

        function goToAITool(toolName) { showMessage(`跳转到 ${toolName} 页面`); }
        function goToErrorBook() { window.parent.postMessage({ type: 'SWITCH_TAB', index: 2 }, '*'); }
        function goToResourceCenter() { window.parent.postMessage({ type: 'SWITCH_TAB', index: 1 }, '*'); }
        function goToIncentiveCenter() { showMessage('跳转到积分中心'); }
        function viewLatestReport() { showMessage('正在加载最新周/月报告...'); }

        // 切换任务标签
        function switchTaskTab(tab) {
            const todayList = document.getElementById('today-tasks-list');
            const weekList = document.getElementById('week-tasks-list');
            const noTask = document.getElementById('no-task-today');
            const tabToday = document.getElementById('tab-today');
            const tabWeek = document.getElementById('tab-week');

            if (tab === 'today') {
                tabToday.className = 'text-lg font-bold text-gray-800 border-b-2 border-cyan-500 pb-2';
                tabWeek.className = 'text-lg text-gray-400 pb-2';
                weekList.classList.add('hidden');

                // Check simulation state
                if (document.getElementById('no-task-today').dataset.simulated === 'true') {
                    todayList.classList.add('hidden');
                    noTask.classList.remove('hidden');
                } else {
                    todayList.classList.remove('hidden');
                    noTask.classList.add('hidden');
                }
            } else {
                tabWeek.className = 'text-lg font-bold text-gray-800 border-b-2 border-cyan-500 pb-2';
                tabToday.className = 'text-lg text-gray-400 pb-2';
                todayList.classList.add('hidden');
                noTask.classList.add('hidden');
                weekList.classList.remove('hidden');
            }
        }

        // 模拟无作业状态
        function toggleNoHomework() {
            const noTask = document.getElementById('no-task-today');
            const todayList = document.getElementById('today-tasks-list');
            const isSimulated = noTask.dataset.simulated === 'true';

            if (isSimulated) {
                noTask.dataset.simulated = 'false';
                switchTaskTab('today'); // Reset to normal
            } else {
                noTask.dataset.simulated = 'true';
                switchTaskTab('today'); // Show empty state
            }
        }

        // 切换孩子模态框
        function openSwitchChildModal() {
            document.getElementById('switch-child-modal').classList.remove('hidden');
        }

        function closeSwitchChildModal() {
            document.getElementById('switch-child-modal').classList.add('hidden');
        }

        function switchStudent(name) {
            document.getElementById('current-student-name').textContent = name;
            closeSwitchChildModal();
            showMessage(`已切换到学生：${name}`);
        }

        // 年级切换模态框逻辑
        function openGradeModal() {
            document.getElementById('grade-switch-modal').classList.remove('hidden');
        }

        function closeGradeModal() {
            document.getElementById('grade-switch-modal').classList.add('hidden');
        }

        function toggleSystem(sys) {
            const btn63 = document.getElementById('sys-63');
            const btn54 = document.getElementById('sys-54');

            if (sys === '63') {
                btn63.className = 'px-8 py-2 rounded-md text-sm font-bold bg-cyan-500 text-white shadow-sm transition-all';
                btn54.className = 'px-8 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition-all';
            } else {
                btn54.className = 'px-8 py-2 rounded-md text-sm font-bold bg-cyan-500 text-white shadow-sm transition-all';
                btn63.className = 'px-8 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition-all';
            }
        }

        function selectGrade(grade, btnElement) {
            // Update UI for all buttons
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.className = 'grade-btn border border-gray-200 rounded-lg py-2.5 text-sm text-gray-600 hover:border-cyan-500 hover:text-cyan-500 transition-colors';
            });

            // Update selected button
            if (btnElement) {
                btnElement.className = 'grade-btn bg-cyan-50 border border-cyan-500 rounded-lg py-2.5 text-sm text-cyan-500 font-bold transition-colors';
            }

            // Update Header Text
            document.getElementById('current-grade-text').textContent = grade + ' (上)';

            // Close Modal
            setTimeout(closeGradeModal, 200);
        }
    </script>
</body>

</html>